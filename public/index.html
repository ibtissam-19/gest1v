<!doctype html>
<html lang="fr">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Gest_LI â€” Interface Dark</title>
        <link rel="icon" href="data:;base64,iVBORw0KGgo=" />
        <style>
            /* Variables de thÃ¨mes */
            :root {
                --bg-body: #f7f7fb;
                --bg-card: white;
                --text-main: #222;
                --text-muted: #6b7280;
                --border-color: #e6e9ef;
                --header-bg: #3b82f6;
                --input-bg: white;
                --input-border: #d1d5db;
            }

            [data-theme="dark"] {
                --bg-body: #111827;
                --bg-card: #1f2937;
                --text-main: #f9fafb;
                --text-muted: #9ca3af;
                --border-color: #374151;
                --header-bg: #1e40af;
                --input-bg: #374151;
                --input-border: #4b5563;
            }

            body { 
                margin: 0; 
                background: var(--bg-body); 
                color: var(--text-main); 
                font-family: system-ui, -apple-system, sans-serif; 
                transition: background 0.3s, color 0.3s;
            }

            header { 
                background: var(--header-bg); 
                color: white; 
                padding: 1rem 1.25rem; 
                display: flex; 
                justify-content: space-between; 
                align-items: center; 
            }
            
            header h1 { margin: 0; font-size: 1.25rem; }

            main { 
                max-width: 900px; 
                margin: 1.25rem auto; 
                padding: 1rem; 
                background: var(--bg-card); 
                border-radius: 8px; 
                box-shadow: 0 6px 18px rgba(0,0,0,0.1); 
            }

            .controls { display: flex; gap: .5rem; flex-wrap: wrap; margin-bottom: 1rem; }
            
            input { 
                padding: .5rem; 
                background: var(--input-bg); 
                color: var(--text-main);
                border: 1px solid var(--input-border); 
                border-radius: 6px; 
            }

            button { background: #10b981; border: none; color: white; padding: .5rem .75rem; border-radius: 6px; cursor: pointer; font-weight: bold; }
            
            #theme-toggle { background: rgba(255,255,255,0.2); border: 1px solid white; font-size: 0.8rem; }

            table { width: 100%; border-collapse: collapse; }
            th, td { padding: .75rem; border-bottom: 1px solid var(--border-color); text-align: left; }
            th { color: var(--text-muted); font-size: 0.85rem; text-transform: uppercase; }

            footer { max-width: 900px; margin: 0.5rem auto 2rem; color: var(--text-muted); font-size: .9rem; text-align: center; }
            code { background: var(--border-color); padding: 2px 4px; border-radius: 4px; }
        </style>
    </head>
    <body>
        <header>
            <div>
                <h1>Gest_LI</h1>
                <div style="font-size:.8rem; opacity:.9">Gestion d'inventaire</div>
            </div>
            <button id="theme-toggle">ðŸŒ™ Mode Sombre</button>
        </header>

        <main>
            <section id="app">
                <div class="controls">
                    <input id="item-name" type="text" placeholder="Nom de l'Ã©lÃ©ment">
                    <input id="item-qty" type="number" min="1" value="1" style="width: 80px">
                    <button id="add-btn">Ajouter</button>
                    <button id="delete-all-btn" style="background:#ef4444">Supprimer tout</button>
                </div>

                <table id="items">
                    <thead>
                        <tr><th>Nom</th><th>QuantitÃ©</th><th>Action</th></tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </section>
        </main>

        <footer>
            Fichier: <code>public/index.html</code> â€” Dark Mode Actif
        </footer>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const tbody = document.querySelector('#items tbody');
                const addBtn = document.getElementById('add-btn');
                const themeBtn = document.getElementById('theme-toggle');
                const nameEl = document.getElementById('item-name');
                const qtyEl = document.getElementById('item-qty');
                
                let itemsState = [];

                // --- GESTION DARK MODE ---
                const toggleTheme = () => {
                    const currentTheme = document.documentElement.getAttribute('data-theme');
                    const targetTheme = currentTheme === 'dark' ? 'light' : 'dark';
                    document.documentElement.setAttribute('data-theme', targetTheme);
                    themeBtn.innerText = targetTheme === 'dark' ? 'â˜€ï¸ Mode Clair' : 'ðŸŒ™ Mode Sombre';
                    localStorage.setItem('theme', targetTheme);
                };

                themeBtn.addEventListener('click', toggleTheme);

                // Charger le thÃ¨me sauvegardÃ©
                if(localStorage.getItem('theme') === 'dark') {
                    document.documentElement.setAttribute('data-theme', 'dark');
                    themeBtn.innerText = 'â˜€ï¸ Mode Clair';
                }

                // --- LOGIQUE API ---
                async function loadItems(){
                    try{
                        const res = await fetch('/api/items');
                        itemsState = await res.json();
                        renderTable();
                    }catch(e){ console.warn('Erreur chargement:', e); }
                }

                function renderTable(){
                    tbody.innerHTML = '';
                    itemsState.forEach((it, idx) => {
                        const tr = document.createElement('tr');
                        const name = escapeHtml(it.name ?? it);
                        const qty = escapeHtml(it.qty ?? it.quantity ?? 1);
                        tr.innerHTML = `
                            <td>${name}</td>
                            <td>${qty}</td>
                            <td><button onclick="deleteItem(${idx})" style="background:#ef4444; padding: 4px 8px; font-size: 12px;">Supprimer</button></td>
                        `;
                        tbody.appendChild(tr);
                    });
                }

                window.deleteItem = async (index) => {
                    const itemName = itemsState[index].name || itemsState[index];
                    try {
                        // Utilisation de la nouvelle route dynamique /api/items/:item
                        const res = await fetch(`/api/items/${encodeURIComponent(itemName)}`, { method: 'DELETE' });
                        if(res.ok) {
                            itemsState = await res.json();
                            renderTable();
                        }
                    } catch(e) { console.error("Erreur suppression", e); }
                };

                addBtn.addEventListener('click', async () => {
                    const name = nameEl.value.trim();
                    const qty = Number(qtyEl.value) || 1;
                    if(!name) return;
                    try{
                        const res = await fetch('/api/items', { 
                            method: 'POST', 
                            headers:{'Content-Type':'application/json'}, 
                            body: JSON.stringify({ item: { name, qty } }) 
                        });
                        itemsState = await res.json();
                        renderTable();
                        nameEl.value = '';
                    }catch(e){ console.warn('Erreur ajout:', e); }
                });

                document.getElementById('delete-all-btn').addEventListener('click', async () => {
                    if(!confirm('Tout supprimer ?')) return;
                    await fetch('/api/items', { method: 'DELETE' });
                    itemsState = [];
                    renderTable();
                });

                function escapeHtml(s){
                    return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
                }

                loadItems();
            });
        </script>
    </body>
</html>