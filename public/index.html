<!doctype html>
<html lang="fr">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Gest_LI — Interface</title>
		<link rel="icon" href="data:;base64,iVBORw0KGgo=" />
		<style>
			:root{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;line-height:1.4;color:#222}
			body{margin:0;background:#f7f7fb}
			header{background:#3b82f6;color:white;padding:1rem 1.25rem}
			header h1{margin:0;font-size:1.25rem}
			main{max-width:900px;margin:1.25rem auto;padding:1rem;background:white;border-radius:8px;box-shadow:0 6px 18px rgba(16,24,40,0.06)}
			.controls{display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:1rem}
			input[type="text"],input[type="number"]{padding:.5rem;border:1px solid #d1d5db;border-radius:6px}
			button{background:#10b981;border:none;color:white;padding:.5rem .75rem;border-radius:6px;cursor:pointer}
			table{width:100%;border-collapse:collapse}
			th,td{padding:.5rem;border-bottom:1px solid #e6e9ef;text-align:left}
			footer{max-width:900px;margin:0.5rem auto 2rem;color:#6b7280;font-size:.9rem}
		</style>
	</head>
	<body>
		<header>
			<h1>Gest_LI</h1>
			<div style="font-size:.9rem;opacity:.95">Interface d'exemple — modifiez ce fichier selon vos besoins</div>
		</header>

		<main>
			<section id="app">
				<p>Bienvenue — interface minimale pour l'application. Ajoutez des éléments ci-dessous pour tester l'UI locale.</p>

				<div class="controls" aria-label="Ajout d'élément">
					<input id="item-name" type="text" placeholder="Nom de l'élément" aria-label="Nom de l'élément">
					<input id="item-qty" type="number" min="1" value="1" aria-label="Quantité">
					<button id="add-btn">Ajouter</button>
					<button id="delete-all-btn" style="background:#ef4444">Supprimer tout</button>
				</div>

				<table id="items" aria-live="polite">
					<thead>
						<tr><th>Nom</th><th>Quantité</th></tr>
					</thead>
					<tbody></tbody>
				</table>
			</section>
		</main>

		<footer>
			<div>Fichier: <code>public/index.html</code> — Utilisez <code>../app.js</code> pour la logique côté client si nécessaire.</div>
		</footer>

		<!-- L'application cliente principale (à la racine du projet) -->
		<script src="../app.js"></script>
		<script>
			// UI logic: charge, ajoute et supprime les éléments en synchronisant avec l'API
			document.addEventListener('DOMContentLoaded', () => {
				const tbody = document.querySelector('#items tbody');
				const addBtn = document.getElementById('add-btn');
				const deleteAllBtn = document.getElementById('delete-all-btn');
				const nameEl = document.getElementById('item-name');
				const qtyEl = document.getElementById('item-qty');
				let itemsState = [];

				async function loadItems(){
					try{
						const res = await fetch('/api/items');
						if(!res.ok) throw new Error('Erreur réseau');
						itemsState = await res.json();
						renderTable();
					}catch(e){
						console.warn('Impossible de charger les éléments:', e);
					}
				}

				function renderTable(){
					tbody.innerHTML = '';
					itemsState.forEach((it, idx) => {
						const tr = document.createElement('tr');
						const name = escapeHtml(it.name ?? it);
						const qty = escapeHtml(it.qty ?? it.quantity ?? 1);
						tr.innerHTML = `<td>${name}</td><td>${qty}</td><td><button class="del-btn" data-idx="${idx}" style="background:#ef4444">Supprimer</button></td>`;
						tbody.appendChild(tr);
					});
					// attach delete handlers
					tbody.querySelectorAll('.del-btn').forEach(btn => {
						btn.addEventListener('click', async (e) => {
							const i = Number(btn.getAttribute('data-idx'));
							deleteItem(i);
						});
					});
				}

				async function deleteItem(index){
					itemsState.splice(index,1);
					// Pour synchroniser le serveur (qui ne propose qu'un DELETE total),
					// on vide d'abord tout côté serveur puis on ré-ajoute les éléments restants.
					try{
						await fetch('/api/items', { method: 'DELETE' });
						for(const it of itemsState){
							await fetch('/api/items', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ item: it }) });
						}
					}catch(e){
						console.warn('Erreur synchronisation suppression:', e);
					}
					renderTable();
				}

				addBtn.addEventListener('click', async () => {
					const name = nameEl.value.trim();
					const qty = Number(qtyEl.value) || 1;
					if(!name){ alert("Entrez un nom d'élément."); nameEl.focus(); return; }
					try{
						const res = await fetch('/api/items', { method: 'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ item: { name, qty } }) });
						if(!res.ok) throw new Error('Erreur ajout');
						itemsState = await res.json();
						renderTable();
						nameEl.value = '';
						qtyEl.value = 1;
					}catch(e){
						console.warn('Impossible d\'ajouter:', e);
					}
				});

				deleteAllBtn.addEventListener('click', async () => {
					if(!confirm('Voulez-vous vraiment supprimer tous les éléments ?')) return;
					try{
						const res = await fetch('/api/items', { method: 'DELETE' });
						if(!res.ok) throw new Error('Erreur serveur');
						itemsState = [];
						renderTable();
					}catch(e){
						console.warn('Erreur suppression totale:', e);
					}
				});

				// initial load
				loadItems();
			});

			function escapeHtml(s){
				return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
			}
		</script>
	</body>
</html>
